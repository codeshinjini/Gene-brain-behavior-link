<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Reduce an image applying Gaussian Pyramid.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S2T0U3">IResult</span> = <span class="message error" id="M1F1C">GPReduce</span>(<span class="var type0" id="S3T0U6">I</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="var type0" id="S4T0U9">Wt</span> = [0.0500    0.2500    0.4000    0.2500    0.0500];</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="var type0" id="S5T0U19">dim</span> = size(<span class="var type0" id="S3T0U22">I</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="var type0" id="S7T0U25">newdim</span> = ceil(<span class="var type0" id="S5T0U29">dim</span>*0.5);</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="var type0" id="S2T0U33">IResult</span> = zeros(<span class="var type0" id="S7T0U36">newdim</span>,class(<span class="var type0" id="S3T0U39">I</span>)); <span class="comment">% Initialize the array in the beginning ..</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="var type0" id="S11T0U42">m</span> = [-2:2];<span class="var type0" id="S12T0U51">n</span>=<span class="var type0" id="S11T0U52">m</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="keyword">switch</span> length(<span class="var type0" id="S5T0U56">dim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="comment">%% Pad the boundaries.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="var type0" id="S3T0U61">I</span> = [ <span class="var type0" id="S3T0U65">I</span>(1) ; <span class="var type0" id="S3T0U69">I</span>(1) ;  <span class="var type0" id="S3T0U72">I</span> ; <span class="var type0" id="S3T0U75">I</span>(<span class="var type0" id="S5T0U77">dim</span>(1));  <span class="var type0" id="S3T0U81">I</span>(<span class="var type0" id="S5T0U83">dim</span>(1)) ];  <span class="comment">% Add two rows towards the beginning and the end.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S14T0U87">i</span> = 0 : <span class="var type0" id="S7T0U92">newdim</span>(1) -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">            <span class="var type0" id="S15T0U97">A</span> = <span class="var type0" id="S3T0U100">I</span>(2*<span class="var type0" id="S14T0U105">i</span>+<span class="var type0" id="S11T0U106">m</span>+3).*<span class="var type0" id="S4T0U108">Wt</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">            <span class="var type0" id="S2T0U112">IResult</span>(<span class="var type0" id="S14T0U114">i</span> + 1)= sum(<span class="var type0" id="S15T0U119">A</span>(:));</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">case</span> 2</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">        <span class="comment">%% Pad the boundaries.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">        <span class="var type0" id="S3T0U125">I</span> = [ <span class="var type0" id="S3T0U129">I</span>(1,:) ; <span class="var type0" id="S3T0U134">I</span>(1,:) ;  <span class="var type0" id="S3T0U138">I</span> ; <span class="var type0" id="S3T0U141">I</span>(<span class="var type0" id="S5T0U143">dim</span>(1),:);  <span class="var type0" id="S3T0U148">I</span>(<span class="var type0" id="S5T0U150">dim</span>(1),:) ];  <span class="comment">% Add two rows towards the beginning and the end.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">        <span class="var type0" id="S3T0U155">I</span> = [ <span class="var type0" id="S3T0U159">I</span>(:,1)  <span class="var type0" id="S3T0U163">I</span>(:,1)     <span class="var type0" id="S3T0U166">I</span>   <span class="var type0" id="S3T0U168">I</span>(:,<span class="var type0" id="S5T0U171">dim</span>(2))  <span class="var type0" id="S3T0U174">I</span>(:,<span class="var type0" id="S5T0U177">dim</span>(2)) ];  <span class="comment">% Add two columns towards the beginning and the end.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        <span class="var type0" id="S17T0U181">Wt2</span> = <span class="var type0" id="S4T0U184">Wt</span>'*<span class="var type0" id="S4T0U185">Wt</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S14T0U188">i</span> = 0 : <span class="var type0" id="S7T0U193">newdim</span>(1) -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">            <span class="keyword">for</span> <span class="var type0" id="S18T0U198">j</span> = 0 : <span class="var type0" id="S7T0U203">newdim</span>(2) -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">                <span class="var type0" id="S15T0U208">A</span> = <span class="var type0" id="S3T0U211">I</span>(2*<span class="var type0" id="S14T0U216">i</span>+<span class="var type0" id="S11T0U217">m</span>+3,2*<span class="var type0" id="S18T0U223">j</span>+<span class="var type0" id="S11T0U224">m</span>+3).*<span class="var type0" id="S17T0U226">Wt2</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">                <span class="var type0" id="S2T0U230">IResult</span>(<span class="var type0" id="S14T0U232">i</span> + 1, <span class="var type0" id="S18T0U235">j</span> + 1) = sum(<span class="var type0" id="S15T0U240">A</span>(:));</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    <span class="keyword">case</span> 3</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="var type0" id="S19T0U246">Wt3</span> = ones(5,5,5);</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S14T0U254">i</span> = 1:5</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">            <span class="var type0" id="S19T0U261">Wt3</span>(<span class="var type0" id="S14T0U262">i</span>,:,:) = <span class="var type0" id="S19T0U267">Wt3</span>(<span class="var type0" id="S14T0U268">i</span>,:,:) * <span class="var type0" id="S4T0U272">Wt</span>(<span class="var type0" id="S14T0U273">i</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">            <span class="var type0" id="S19T0U277">Wt3</span>(:,<span class="var type0" id="S14T0U279">i</span>,:) = <span class="var type0" id="S19T0U283">Wt3</span>(:,<span class="var type0" id="S14T0U285">i</span>,:) * <span class="var type0" id="S4T0U288">Wt</span>(<span class="var type0" id="S14T0U289">i</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">            <span class="var type0" id="S19T0U293">Wt3</span>(:,:,<span class="var type0" id="S14T0U296">i</span>) = <span class="var type0" id="S19T0U299">Wt3</span>(:,:,<span class="var type0" id="S14T0U302">i</span>) * <span class="var type0" id="S4T0U304">Wt</span>(<span class="var type0" id="S14T0U305">i</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">        <span class="comment">%% Pad the boundaries.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">        <span class="var type0" id="S21T0U308">I2</span> = zeros(<span class="var type0" id="S5T0U312">dim</span>+4,class(<span class="var type0" id="S3T0U316">I</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">        <span class="var type0" id="S21T0U320">I2</span>(3:2+<span class="var type0" id="S5T0U326">dim</span>(1),3:2+<span class="var type0" id="S5T0U333">dim</span>(2),3:2+<span class="var type0" id="S5T0U340">dim</span>(3)) = <span class="var type0" id="S3T0U342">I</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        <span class="var type0" id="S21T0U346">I2</span>(1,:,:)=<span class="var type0" id="S21T0U351">I2</span>(3,:,:);<span class="var type0" id="S21T0U358">I2</span>(1,:,:)=<span class="var type0" id="S21T0U363">I2</span>(3,:,:);<span class="var type0" id="S21T0U370">I2</span>(end,:,:)=<span class="var type0" id="S21T0U376">I2</span>(end-2,:,:);<span class="var type0" id="S21T0U386">I2</span>(end-1,:,:)=<span class="var type0" id="S21T0U394">I2</span>(end-2,:,:);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="var type0" id="S21T0U404">I2</span>(:,1,:)=<span class="var type0" id="S21T0U409">I2</span>(:,3,:);<span class="var type0" id="S21T0U416">I2</span>(:,2,:)=<span class="var type0" id="S21T0U421">I2</span>(:,3,:);<span class="var type0" id="S21T0U428">I2</span>(:,end,:)=<span class="var type0" id="S21T0U434">I2</span>(:,end-2,:);<span class="var type0" id="S21T0U444">I2</span>(:,end-1,:)=<span class="var type0" id="S21T0U452">I2</span>(:,end-2,:);</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">        <span class="var type0" id="S21T0U462">I2</span>(:,:,1)=<span class="var type0" id="S21T0U467">I2</span>(:,:,3);<span class="var type0" id="S21T0U474">I2</span>(:,:,2)=<span class="var type0" id="S21T0U479">I2</span>(:,:,3);<span class="var type0" id="S21T0U486">I2</span>(:,:,end)=<span class="var type0" id="S21T0U492">I2</span>(:,:,end-2);<span class="var type0" id="S21T0U502">I2</span>(:,:,end-1)=<span class="var type0" id="S21T0U510">I2</span>(:,:,end-2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">        <span class="var type0" id="S3T0U519">I</span>=<span class="var type0" id="S21T0U520">I2</span>; <span class="comment">%clear I2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S14T0U523">i</span> = 0 : <span class="var type0" id="S7T0U528">newdim</span>(1) -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">            <span class="keyword">for</span> <span class="var type0" id="S18T0U533">j</span> = 0 : <span class="var type0" id="S7T0U538">newdim</span>(2) -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">                <span class="keyword">for</span> <span class="var type0" id="S23T0U543">k</span> = 0 : <span class="var type0" id="S7T0U548">newdim</span>(3) - 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">                    <span class="var type0" id="S15T0U553">A</span> = <span class="var type0" id="S3T0U556">I</span>(2*<span class="var type0" id="S14T0U561">i</span>+<span class="var type0" id="S11T0U562">m</span>+3,2*<span class="var type0" id="S18T0U568">j</span>+<span class="var type0" id="S11T0U569">m</span>+3,2*<span class="var type0" id="S23T0U575">k</span>+<span class="var type0" id="S11T0U576">m</span>+3).*<span class="var type0" id="S19T0U578">Wt3</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">                    <span class="var type0" id="S2T0U582">IResult</span>(<span class="var type0" id="S14T0U584">i</span>+1,<span class="var type0" id="S18T0U587">j</span>+1,<span class="var type0" id="S23T0U590">k</span>+1) = sum(<span class="var type0" id="S15T0U595">A</span>(:));</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"></span></span>
</pre>
